From bde26da80122117cce5cea65e1d51129fc5a7e3c Mon Sep 17 00:00:00 2001
From: y00316549 <yangshukui@huawei.com>
Date: Thu, 18 Jan 2018 19:39:47 +0800
Subject: [PATCH] hyperstart: fix several mem leak

Signed-off-by: y00316549 <yangshukui@huawei.com>
---
 src/container.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/src/container.c b/src/container.c
index 1d07180..51cc3bc 100644
--- a/src/container.c
+++ b/src/container.c
@@ -249,12 +249,19 @@ static int container_setup_modules(struct hyper_container *container)
 	if (stat(dst, &st) == 0) {
 		struct dirent **list;
 		int num;
+		int i;
 
 		if (!S_ISDIR(st.st_mode)) {
 			return -1;
 		}
 
 		num = scandir(dst, &list, NULL, NULL);
+               if (num > 1) {
+                       for (i = 0; i < num; i++) {
+                               free(list[i]);
+                       }
+                       free(list);
+               }
 		if (num > 2) {
 			fprintf(stdout, "%s is not null, %d", dst, num);
 			return 0;
@@ -499,6 +506,9 @@ static int hyper_rescan_scsi(void)
 	}
 
 	fprintf(stdout, "finish scan scsi\n");
+      for (i = 0; i < num; i++) {
+               free(list[i]);
+       }
 	free(list);
 	return 0;
 }
-- 
2.23.0

